<aside class="sidebar" [class.collapsed]="collapsed">
  <!-- User Profile Block -->
  <div class="user-profile-block">
    <div class="user-profile-content">
      <div class="user-avatar-wrapper">
        <img
          [src]="currentUser.avatar"
          [alt]="currentUser.name"
          class="user-avatar"
        />
        <span
          class="status-indicator"
          [class]="getStatusClass(currentUser.status)"
          [attr.title]="currentUser.status"
        ></span>
      </div>
      @if (!collapsed) {
        <div class="user-info">
          <div class="user-name">{{ currentUser.name }}</div>
          <div class="user-email">{{ currentUser.email }}</div>
          <span class="badge bg-primary user-role-badge">{{ currentUser.role }}</span>
        </div>
      }
    </div>
    @if (!collapsed) {
      <div class="user-profile-actions">
        <button
          type="button"
          class="btn btn-sm btn-outline-primary w-100"
          [title]="'nav.profile' | translate"
        >
          <i class="bi bi-person me-1"></i>
          {{ 'nav.profile' | translate }}
        </button>
      </div>
    }
  </div>

  <!-- Navigation Menu -->
  <nav class="sidebar-nav">
    <div class="nav-section">
      @if (!collapsed) {
        <div class="nav-section-title">{{ 'nav.main.menu' | translate }}</div>
      }
      @for (item of menuItems; track item.id) {
        @if (item.children) {
          <!-- Parent menu item with children -->
          <div class="nav-item-wrapper">
            <button
              type="button"
              class="nav-link nav-link-parent"
              [class.active]="isMenuExpanded(item)"
              (click)="toggleMenuItem(item)"
              [title]="collapsed ? (item.labelKey | translate) : ''"
            >
              <i [class]="item.icon + ' nav-icon'"></i>
              @if (!collapsed) {
                <span class="nav-label">{{ item.labelKey | translate }}</span>
                <i class="bi bi-chevron-down nav-arrow" [class.rotated]="isMenuExpanded(item)"></i>
              }
            </button>
            @if (!collapsed) {
              <div class="nav-submenu" [ngbCollapse]="!isMenuExpanded(item)">
                @for (child of item.children; track child.id) {
                  <a
                    [routerLink]="child.route"
                    routerLinkActive="active"
                    class="nav-link nav-link-child"
                  >
                    <i [class]="child.icon + ' nav-icon'"></i>
                    <span class="nav-label">{{ child.labelKey | translate }}</span>
                  </a>
                }
              </div>
            }
          </div>
        } @else {
          <!-- Single menu item -->
          <a
            [routerLink]="item.route"
            routerLinkActive="active"
            class="nav-link"
            [title]="collapsed ? (item.labelKey | translate) : ''"
          >
            <i [class]="item.icon + ' nav-icon'"></i>
            @if (!collapsed) {
              <span class="nav-label">{{ item.labelKey | translate }}</span>
              @if (getUserBadge(item)) {
                <span [class]="'badge ms-auto ' + item.badgeClass">{{ getUserBadge(item) }}</span>
              }
            } @else if (getUserBadge(item)) {
              <span class="badge-dot" [class]="item.badgeClass"></span>
            }
          </a>
        }
      }
    </div>
  </nav>

  <!-- Sidebar Footer -->
  @if (!collapsed) {
    <div class="sidebar-footer">
      <div class="footer-stats">
        <div class="stat-item">
          <i class="bi bi-hdd text-primary"></i>
          <div class="stat-info">
            <div class="stat-label">{{ 'sidebar.storage' | translate }}</div>
            <div class="stat-value">4.2 GB / 10 GB</div>
          </div>
        </div>
        <div class="progress" style="height: 4px;">
          <div
            class="progress-bar bg-primary"
            role="progressbar"
            style="width: 42%"
            aria-valuenow="42"
            aria-valuemin="0"
            aria-valuemax="100"
          ></div>
        </div>
      </div>
    </div>
  }
</aside>
