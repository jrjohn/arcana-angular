<div class="user-panel" [class.open]="isOpen">
  <!-- Panel Header -->
  <div class="panel-header">
    <h5 class="panel-title">
      <i class="bi bi-people me-2"></i>
      User Management
    </h5>
    <button
      type="button"
      class="btn btn-link close-btn"
      (click)="onClose()"
      aria-label="Close"
    >
      <i class="bi bi-x-lg"></i>
    </button>
  </div>

  <!-- Search Bar -->
  <div class="search-bar">
    <div class="input-group">
      <span class="input-group-text">
        <i class="bi bi-search"></i>
      </span>
      <input
        type="text"
        class="form-control"
        placeholder="Search users..."
        [value]="vm.searchQuery()"
        (input)="onSearch($any($event.target).value)"
      />
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-bar">
    <button class="btn btn-sm btn-primary w-100" (click)="onCreateUser()">
      <i class="bi bi-person-plus me-2"></i>
      Create New User
    </button>
    <button class="btn btn-sm btn-outline-secondary w-100" (click)="onViewAll()">
      <i class="bi bi-list-ul me-2"></i>
      View All Users
    </button>
  </div>

  <!-- User List -->
  <div class="panel-body">
    @if (vm.isLoading()) {
      <div class="loading-state">
        <app-loading-spinner />
        <p class="text-muted mt-3">Loading users...</p>
      </div>
    } @else if (vm.isEmpty()) {
      <div class="empty-state">
        <i class="bi bi-inbox display-4 text-muted"></i>
        <h6 class="mt-3">No Users Found</h6>
        <p class="text-muted">
          @if (vm.searchQuery()) {
            Try a different search term
          } @else {
            Start by creating your first user
          }
        </p>
      </div>
    } @else {
      <div class="user-list">
        @for (user of vm.users(); track user.id) {
          <div class="user-item" (click)="onViewUser(user)">
            <div class="user-avatar">
              @if (user.avatar) {
                <img [src]="user.avatar" [alt]="user.firstName + ' ' + user.lastName" />
              } @else {
                <div class="avatar-placeholder">
                  <i class="bi bi-person"></i>
                </div>
              }
            </div>
            <div class="user-info">
              <div class="user-name">{{ user.firstName }} {{ user.lastName }}</div>
              <div class="user-email">{{ user.email }}</div>
            </div>
            <div class="user-actions">
              <button
                class="btn btn-sm btn-outline-primary"
                (click)="onEditUser(user, $event)"
                ngbTooltip="Edit User"
                placement="left"
              >
                <i class="bi bi-pencil"></i>
              </button>
            </div>
          </div>
        }
      </div>

      <!-- Pagination -->
      <div class="panel-footer">
        <div class="pagination-info">
          <small class="text-muted">
            Showing {{ vm.startIndex() }} - {{ vm.endIndex() }} of {{ vm.totalItems() }}
          </small>
        </div>
        @if (vm.hasMultiplePages()) {
          <ngb-pagination
            [(page)]="currentPageValue"
            [pageSize]="vm.pageSize()"
            [collectionSize]="vm.totalItems()"
            [maxSize]="3"
            [rotate]="true"
            [boundaryLinks]="true"
            size="sm"
            (pageChange)="onPageChange($event)"
          ></ngb-pagination>
        }
      </div>
    }
  </div>
</div>

<!-- Overlay -->
@if (isOpen) {
  <div class="panel-overlay" (click)="onClose()"></div>
}
